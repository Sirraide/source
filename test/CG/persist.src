// R %srcc --ir --target x86_64-unknown-linux %s
program test;

proc g {
    eval {
        int q = 42;
        &q;
    }
}

proc h {
    // Ok since the value is unused.
    eval {
        int i;
        int[](&i, 1);
    };
}

proc x {}
proc foobar = true;

proc p1 {
    var s2 = eval x;
    s2();
}

proc p2 {
    (eval x)();
}

proc p3 {
    (eval if foobar() then p1 else p2)();
    (eval if foobar() then p2 else p1)();
}

proc p6 {
    proc t1 ($T t) = t;
    var q1 = eval t1(42);
    var q2 = t1(42);
}

struct s {
    int x;
    int^? y;
}

struct s2 {
    s a;
    s? b;
}

struct s3 {
    int x;
    int y;
}

struct s4 {
    s3 a;
    s3? b;
}

struct s5 {
    s3 a;
    s b;
}

proc r1 {
    var x = eval s(42, ());
};

proc r2 {
    var x = eval s2(s(1, ()), s(2, ()));
}

proc r3 = eval {
    var a = eval s(20, ());
    var b = eval s(22, ());
    a.x + b.x;
};

#assert r3() == 42;

proc r4 {
    var x1 = eval s3(1, 2);
    var x2 = eval s4(s3(3, 4), ());
    var x3 = eval s4(s3(5, 6), s3(7, 8));
    var x4 = eval i8?();
    var x5 = eval i8?(9);
}

proc r5 {
    var x1 = eval s5(s3(1, 2), s(3, ()));
}

proc r6 {
    var y = eval {
        int i;
        s(i, ());
    };
}

struct string {
    i8[] str;
}

proc str {
    var x = "foo";
    var y = eval "bar";
    string s1 = ("baz");
    string s2 = eval string("quux");
}


proc str1 {
    var x1 = eval __srcc_ptradd("1234".data, 0);
    var x2 = eval __srcc_ptradd("1234".data, 1);
    var x3 = eval __srcc_ptradd("1234".data, 3);
    var x4 = eval __srcc_ptradd("1234".data, 4);
}

// * @0 = "\01\00\00\00\00\00\00\00\02\00\00\00\00\00\00\00", align 8
// + @1 = "\03\00\00\00\00\00\00\00\04\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00\00", align 8
// + @2 = "\05\00\00\00\00\00\00\00\06\00\00\00\00\00\00\00\07\00\00\00\00\00\00\00\08\00\00\00\00\00\00\00\FF", align 8
// + @3 = "\00\00"
// + @4 = "\09\FF"
// + @5 = "foo\00"
// + @6 = "bar\00"
// + @7 = "baz\00"
// + @8 = "quux\00"
// + @9 = "1234\00"
// +
// + proc __src_main norecurse external ccc {
// + entry:
// +     ret
// + }
// +
// + proc _S1gFvE.1 private ccc {
// + entry:
// +     ret
// + }
// +
// + proc _S1hFvE.2 private ccc {
// + entry:
// +     ret
// + }
// +
// + proc _S1xFvE.3 private ccc {
// + entry:
// +     ret
// + }
// +
// + proc _S6foobarFbE.4 private ccc -> i1 zeroext {
// + entry:
// +     ret i1 true
// + }
// +
// + proc _S2p1FvE.5 private ccc {
// +     #0 = 16, align 8
// +
// + entry:
// +     store #0, _S1xFvE.3, align 8
// +     %0 = ptradd #0, 8
// +     store %0, ptr nil, align 8
// +     %1 = load ptr, #0, align 8
// +     %2 = ptradd #0, 8
// +     %3 = load ptr, %2, align 8
// +     call ccc void %1(ptr %3 nest nofree noundef readonly)
// +     ret
// + }
// +
// + proc _S2p2FvE.6 private ccc {
// + entry:
// +     call ccc void _S1xFvE.3()
// +     ret
// + }
// +
// + proc _S2p3FvE.7 private ccc {
// + entry:
// +     call ccc void _S2p1FvE.5()
// +     call ccc void _S2p2FvE.6()
// +     ret
// + }
// +
// + proc _S2p6FvE.8 private ccc {
// +     #0 = 8, align 8
// +     #1 = 8, align 8
// +
// + entry:
// +     store #0, i64 42, align 8
// +     %0 = call ccc i64 _S2p6$2t1FiiE.17(i64 42)
// +     store #1, i64 %0, align 8
// +     ret
// + }
// +
// + proc _S2p6$2t1FiiE.17 (i64 %0) private ccc -> i64 {
// +     #0 = 8, align 8
// +
// + entry:
// +     store #0, i64 %0, align 8
// +     %1 = load i64, #0, align 8
// +     ret i64 %1
// + }
// +
// + proc _S2r1FvE.9 private ccc {
// +     #0 = 16, align 8
// +
// + entry:
// +     store #0, i64 42, align 8
// +     %0 = ptradd #0, 8
// +     store %0, ptr nil, align 8
// +     ret
// + }
// +
// + proc _S2r2FvE.10 private ccc {
// +     #0 = 33, align 8
// +
// + entry:
// +     store #0, i64 1, align 8
// +     %0 = ptradd #0, 8
// +     store %0, ptr nil, align 8
// +     %1 = ptradd #0, 16
// +     store %1, i64 2, align 8
// +     %2 = ptradd %1, 8
// +     store %2, ptr nil, align 8
// +     %3 = ptradd %1, 16
// +     store %3, i8 -1, align 1
// +     %4 = ptradd %1, 16
// +     engage %4
// +     ret
// + }
// +
// + proc _S2r3FiE.11 private ccc -> i64 {
// + entry:
// +     ret i64 42
// + }
// +
// + proc _S2r4FvE.12 private ccc {
// +     #0 = 16, align 8
// +     #1 = 33, align 8
// +     #2 = 33, align 8
// +     #3 = 2, align 1
// +     #4 = 2, align 1
// +
// + entry:
// +     copy #0 <- @0, 16
// +     copy #1 <- @1, 33
// +     copy #2 <- @2, 33
// +     copy #3 <- @3, 2
// +     copy #4 <- @4, 2
// +     ret
// + }
// +
// + proc _S2r5FvE.13 private ccc {
// +     #0 = 32, align 8
// +
// + entry:
// +     copy #0 <- @0, 16
// +     %0 = ptradd #0, 16
// +     store %0, i64 3, align 8
// +     %1 = ptradd %0, 8
// +     store %1, ptr nil, align 8
// +     ret
// + }
// +
// + proc _S2r6FvE.14 private ccc {
// +     #0 = 16, align 8
// +
// + entry:
// +     store #0, i64 0, align 8
// +     %0 = ptradd #0, 8
// +     store %0, ptr nil, align 8
// +     ret
// + }
// +
// + proc _S3strFvE.15 private ccc {
// +     #0 = 16, align 8
// +     #1 = 16, align 8
// +     #2 = 16, align 8
// +     #3 = 16, align 8
// +
// + entry:
// +     store #0, ptr @5, align 8
// +     %0 = ptradd #0, 8
// +     store %0, i64 3, align 8
// +     store #1, ptr @6, align 8
// +     %1 = ptradd #1, 8
// +     store %1, i64 3, align 8
// +     store #2, ptr @7, align 8
// +     %2 = ptradd #2, 8
// +     store %2, i64 3, align 8
// +     store #3, ptr @8, align 8
// +     %3 = ptradd #3, 8
// +     store %3, i64 4, align 8
// +     ret
// + }
// +
// + proc _S4str1FvE.16 private ccc {
// +     #0 = 8, align 8
// +     #1 = 8, align 8
// +     #2 = 8, align 8
// +     #3 = 8, align 8
// +
// + entry:
// +     store #0, ptr @9, align 8
// +     %0 = ptradd @9, 1
// +     store #1, ptr %0, align 8
// +     %1 = ptradd @9, 3
// +     store #2, ptr %1, align 8
// +     %2 = ptradd @9, 4
// +     store #3, ptr %2, align 8
// +     ret
// + }
