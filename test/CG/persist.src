// V %srcc --cg --verify %s
program test;

proc f -> int {
    int^y = eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int q = 42;
        &q;
    };

    ^(eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int q = 42;
        &q;
    }) = 42;

    return ^eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int q = 42;
        &q;
    };
}

proc g {
    // This is ok since the value is discarded and thus not emitted.
    eval {
        int q = 42;
        &q;
    }
}

proc h -> int[] {
    int[] s1 = eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int i;
        int[](&i, 1);
    };

    int[] s2 = eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int i;
        int^ j = &i;
        int[](j, 1);
    };

    // Ok since the value is unused.
    eval {
        int i;
        int[](&i, 1);
    };

    return eval { // expected-error: Cannot emit pointer to compile-time stack memory
        int i;
        int[](&i, 1);
    };
}
