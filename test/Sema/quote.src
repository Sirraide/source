// V %srcc --sema --verify %s
program test;

proc good -> int {
    #inject(#quote { int; }) x = #inject(#quote { 22; });
    #inject(#quote { i64; }) y = #inject(#quote { 20 as i64; });
    return #inject(#quote { x; }) + #inject(#quote { y; }) as int;
}

#assert good() == 42;

proc bad {
    #inject(1); // expected-error: Cannot inject value of type 'int'
    #inject(int); // expected-error: Cannot inject value of type 'type'
    #inject(""); // expected-error: Cannot inject value of type 'i8[]'
}

proc add (tree a) = #quote {
    x + $(a) * 2 + y;
};

proc do_add -> int {
    int arg = 15;
    int x = 5;
    int y = 5;
    return 1 + #inject(add(#quote { arg; })) + 1;
}

#assert do_add() == 42;
