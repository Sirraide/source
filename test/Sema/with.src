// V %srcc --sema --verify %s
program test;

struct s {
    int x;
}

proc q = s(42);

eval {
    s a = (1);
    with a { x = 4; }
    assert a.x == 4;
}

eval with s(2) {
    assert x == 2;
    x = 3;
    assert x == 3;
}

eval with q() do assert x == 42;
eval with q() do assert x == 44; // expected-error: Assertion failed: 'x == 44'

eval with i64 {
    assert bits == 64;
    assert bytes == 8;
}

struct s2 {
    int x;
    int y;
}

proc f(in s2 a) = with a { x + y }
#assert f(s2(1, 2)) == 3;